<div class="room-chat">
  <!-- Chat Header -->
  <div class="chat-header">
    <h3>üè† Chat Rooms</h3>
    <button class="create-room-button" (click)="toggleCreateRoom()">
      {{ showCreateRoom ? 'Cancel' : 'Create Room' }}
    </button>
  </div>

  <!-- Create Room Form -->
  <div class="create-room-section" *ngIf="showCreateRoom">
    <div class="create-room-form">
      <div class="form-group">
        <label for="roomName">Room Name</label>
        <input 
          type="text" 
          id="roomName"
          [(ngModel)]="newRoomName"
          placeholder="Enter room name"
          class="form-input"
        />
      </div>
      <div class="form-group">
        <label for="roomDescription">Description (Optional)</label>
        <textarea 
          id="roomDescription"
          [(ngModel)]="newRoomDescription"
          placeholder="Enter room description"
          class="form-textarea"
        ></textarea>
      </div>
      <button 
        (click)="createRoom()"
        class="create-button"
        [disabled]="!newRoomName.trim() || isCreatingRoom"
      >
        {{ isCreatingRoom ? 'Creating...' : 'Create Room' }}
      </button>
    </div>
  </div>

  <!-- Room Lists -->
  <div class="rooms-section" *ngIf="!showCreateRoom && !selectedRoom">
    <!-- My Rooms -->
    <div class="room-category" *ngIf="userRooms.length > 0">
      <h4>My Rooms</h4>
      <div class="room-list">
        <div class="room-item" *ngFor="let room of userRooms" (click)="joinRoom(room)">
          <div class="room-info">
            <h5>{{ room.name }}</h5>
            <p>{{ room.description || 'No description' }}</p>
            <span class="member-count">{{ room.memberCount }} members</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Public Rooms -->
    <div class="room-category">
      <h4>Public Rooms</h4>
      <div class="room-list" *ngIf="publicRooms.length > 0">
        <div class="room-item" *ngFor="let room of publicRooms" (click)="joinRoom(room)">
          <div class="room-info">
            <h5>{{ room.name }}</h5>
            <p>{{ room.description || 'No description' }}</p>
            <span class="member-count">{{ room.memberCount }} members</span>
          </div>
        </div>
      </div>
      <div class="no-rooms" *ngIf="publicRooms.length === 0">
        <p>No public rooms available</p>
      </div>
    </div>
  </div>

  <!-- Room Chat Interface -->
  <div class="room-chat-interface" *ngIf="selectedRoom">
    <!-- Room Header -->
    <div class="room-header">
      <button class="back-button" (click)="leaveRoom()">‚Üê Back to Rooms</button>
      <div class="room-info">
        <h4>{{ selectedRoom.name }}</h4>
        <p>{{ selectedRoom.description || 'No description' }}</p>
        <span class="member-count">{{ selectedRoom.memberCount }} members</span>
      </div>
    </div>

    <!-- Room Messages -->
    <div class="messages-container">
      <div class="message-wrapper" *ngFor="let message of roomMessages">
        <div class="message" [class.own]="message.isOwn">
          <div class="message-avatar" *ngIf="!message.isOwn">
            <span class="avatar-initial">{{ getInitials(message.sender.username) }}</span>
          </div>
          <div class="message-content">
            <div class="message-header" *ngIf="!message.isOwn">
              <span class="sender-name">{{ message.sender.displayName || message.sender.username }}</span>
              <span class="message-time">{{ formatTime(message.timestamp) }}</span>
            </div>
            <div class="message-text">{{ message.content }}</div>
            <div class="message-time own-time" *ngIf="message.isOwn">
              {{ formatTime(message.timestamp) }}
            </div>
          </div>
        </div>
      </div>
      
      <!-- No messages -->
      <div class="no-messages" *ngIf="roomMessages.length === 0">
        <p>No messages in this room yet. Start the conversation!</p>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-container">
        <input 
          type="text" 
          [(ngModel)]="messageInput"
          (keyup.enter)="sendMessage()"
          placeholder="Type room message..."
          class="message-input"
        />
        <button 
          (click)="sendMessage()"
          class="send-button"
          [disabled]="!messageInput.trim()"
        >
          Send
        </button>
      </div>
    </div>
  </div>
</div> 